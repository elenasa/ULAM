## -*- mode:ulam -*-
#=t3985_test_compiler_stringasciiarray_variablelengthof
##
## gen output: interleaved asserts + 1
##  Int Arg: 13
##  Unsigned Arg: 13
##  Int Arg: 14
##
#!
Exit status: 0
Ue_FString { String(32) mfoo[2]("","");  Bool(1) b1(true);  Int(32) test() {  System s;  self mfoo . 0 [] "" = self mfoo . 1 [] "" = String(32) gstr = self ( glyphsRadonX 3 [] 0 cast )init .;  Int(32) slen = 13u cast;  s ( slen )print . self b1 . slen 13 cast == = s ( self b1 . )assert . s ( gstr 0 [] 35u == )assert . s ( 13u )print . s ( true )assert . s ( 14 )print . s ( true )assert . 0 cast return } }
Uq_System { <NOMAIN> }
##
## informed by t3984 (see also t3949)
## lengthof a String array variable (incl data members) is a constant, can be folded (eval)
##
#:FString.ulam
  ulam 3;
/* Glyph representation "cwhdrowspaddedtomultipleof8bits"
   c: char
   w: char width in sites
   h: char height in sites
   d: descent (sites from bottom to baseline)
   then h rows as bitmaps, with (w+7)/8 chars per row
*/
local constant String glyphsRadonX[] = {
    " \000\000\000",
    "!\001\011\000\x80\x80\x80\x80\x80\x80\x00\x80\x80",
    "\042\003\004\005\xa0\xa0\xa0\xa0",
    "#\007\011\000\x44\x44\xba\x44\x44\x44\xba\x44\x44",
    "$\007\011\000\x62\x92\x94\x68\x10\x2c\x52\x92\x8c",
    "&\007\011\000\x60\x90\x90\x40\x20\x90\x8a\x84\x7a",
    "'\003\004\005\x20\x20\x20\xc0",
    "(\002\011\000\x40\x80\x80\x80\x80\x80\x80\x80\x40",
    ")\002\011\000\x80\x40\x40\x40\x40\x40\x40\x40\x80",
    "*\007\010\001\x10\x92\x54\x10\x10\x54\x92\x10",
    "+\007\007\001\x10\x10\x10\xd6\x10\x10\x10",
    ",\007\001\004\xfe",
    ".\001\002\000\x80\x80",
    "/\007\011\000\x02\x02\x02\x04\x08\x10\x20\x40\x80",
    "0\007\011\000\x7c\x82\x82\x8a\x92\xa2\x82\x82\x7c",
    "1\003\011\000\x20\xa0\x20\x20\x20\x20\x20\x20\x20",
    "2\007\011\000\xfc\x02\x02\x02\x7c\x80\x80\x00\xfe",
    "3\007\011\000\xfc\x02\x02\x02\x3c\x02\x02\x02\xfc",
    "4\007\011\000\x82\x82\x82\x82\x7a\x02\x02\x02\x02",
    "5\007\011\000\xfe\x00\x80\x80\x7c\x02\x02\x02\xfc",
    "6\007\011\000\x7c\x80\x80\xbc\x82\x82\x82\x82\x7c",
    "7\007\011\000\xfc\x02\x02\x02\x02\x02\x02\x02\x02",
    "8\007\011\000\x7c\x82\x82\x82\x7c\x82\x82\x82\x7c",
    "9\007\011\000\x7c\x82\x82\x82\x82\x7a\x02\x02\xfc",
    ":\001\007\001\x80\x80\x00\x00\x00\x80\x80",
    ";\003\010\000\x20\x20\x00\x00\x00\x20\x20\xc0",
    "<\004\011\000\x10\x10\x20\x40\x80\x40\x20\x10\x10",
    "=\007\003\003\xfe\x00\xfe",
    ">\004\011\000\x80\x80\x40\x20\x10\x20\x40\x80\x80",
    "?\007\011\000\xfc\x02\x02\x02\x1c\x20\x20\x00\x20",
    "@\007\011\000\x7c\x82\x8a\x92\x92\x92\x8c\x80\x7c",
    "A\007\011\000\x7c\x82\x82\x82\x82\xba\x82\x82\x82",
    "B\007\011\000\xbc\x82\x82\x82\xbc\x82\x82\x82\xbc",
    "C\006\011\000\x7c\x80\x80\x80\x80\x80\x80\x80\x7c",
    "D\007\011\000\xbc\x82\x82\x82\x82\x82\x82\x82\xbc",
    "E\006\011\000\x7c\x80\x80\x80\xb8\x80\x80\x80\x7c",
    "F\006\011\000\x7c\x80\x80\x80\xb8\x80\x80\x80\x80",
    "G\007\011\000\x7c\x80\x80\x80\x80\x9a\x82\x82\x7c",
    "H\007\011\000\x82\x82\x82\x82\xba\x82\x82\x82\x82",
    "I\001\011\000\x80\x80\x80\x80\x80\x80\x80\x80\x80",
    "J\006\011\000\x04\x04\x04\x04\x04\x04\x04\x84\x78",
    "K\007\011\000\x82\x82\x82\x82\xbc\x82\x82\x82\x82",
    "L\007\011\000\x80\x80\x80\x80\x80\x80\x80\x80\x7e",
    "M\007\011\000\x7c\x82\x92\x92\x92\x92\x82\x82\x82",
    "N\007\011\000\x7c\x82\x82\x82\x82\x82\x82\x82\x82",
    "O\007\011\000\x7c\x82\x82\x82\x82\x82\x82\x82\x7c",
    "P\007\011\000\xbc\x82\x82\x82\xbc\x80\x80\x80\x80",
    "Q\007\011\000\x7c\x82\x82\x82\x82\x8a\x8a\x82\x7c",
    "R\007\011\000\xbc\x82\x82\x82\xbc\x82\x82\x82\x82",
    "S\007\011\000\x7e\x80\x80\x80\x7c\x02\x02\x02\xfc",
    "T\007\011\000\xfe\x00\x10\x10\x10\x10\x10\x10\x10",
    "U\007\011\000\x82\x82\x82\x82\x82\x82\x82\x82\x7c",
    "V\007\011\000\x82\x82\x82\x82\x82\x84\x88\x90\xa0",
    "W\007\011\000\x82\x82\x82\x82\x92\x92\x92\x82\x7c",
    "X\007\011\000\x82\x82\x82\x82\x7c\x82\x82\x82\x82",
    "Y\007\011\000\x82\x82\x82\x82\x7c\x00\x10\x10\x10",
    "Z\007\011\000\xfc\x02\x04\x08\x10\x20\x40\x80\x7e",
    "[\004\011\000\x70\x80\x80\x80\x80\x80\x80\x80\x70",
    "\\007\011\000\x80\x80\x80\x40\x20\x10\x08\x04\x02",
    "]\004\011\000\xe0\x10\x10\x10\x10\x10\x10\x10\xe0",
    "^\005\003\006\x70\x88\x88",
    "_\003\004\005\x80\x80\x80\x60",
    "a\006\006\000\x78\x04\x74\x84\x84\x78",
    "b\006\010\000\x80\x80\xb8\x84\x84\x84\x84\x78",
    "c\005\006\000\x78\x80\x80\x80\x80\x78",
    "d\006\010\000\x04\x04\x74\x84\x84\x84\x84\x78",
    "e\006\006\000\x78\x84\x84\xb8\x80\x78",
    "f\005\010\000\x18\x20\x20\x20\xa8\x20\x20\x20",
    "g\006\010\000\x80\x80\xb8\x84\x84\x84\x84\x84",
    "i\001\010\000\x80\x00\x80\x80\x80\x80\x80\x80",
    "j\006\010\000\x80\x80\x84\x84\xb8\x84\x84\x84",
    "l\001\010\000\x80\x80\x80\x80\x80\x80\x80\x80",
    "m\007\006\000\x7c\x82\x92\x92\x92\x92",
    "n\006\006\000\x78\x84\x84\x84\x84\x84",
    "o\006\006\000\x78\x84\x84\x84\x84\x78",
    "p\003\006\000\x60\x80\x80\x80\x80\x80",
    "s\006\006\000\x7c\x80\x78\x04\x04\xf8",
    "t\005\010\000\x20\x20\x20\xa8\x20\x20\x20\x18",
    "u\006\006\000\x84\x84\x84\x84\x84\x78",
    "v\006\006\000\x84\x84\x84\x88\x90\xa0",
    "w\007\006\000\x92\x92\x92\x92\x82\x7c",
    "x\006\006\000\x84\x84\x78\x84\x84\x84",
    "y\006\006\000\xf8\x04\x18\x60\x80\x7c",
    "{\005\011\000\x38\x40\x40\x40\x80\x40\x40\x40\x38",
    "|\001\011\000\x80\x80\x80\x80\x00\x80\x80\x80\x80",
    "}\005\011\000\xe0\x10\x10\x10\x08\x10\x10\x10\xe0",
    "~\005\003\006\x08\x70\x80",
    "\240\000\000\000",
    "\241\001\011\000\x80\x80\x00\x80\x80\x80\x80\x80\x80",
    "\242\006\010\000\x10\x7c\x80\x90\x90\x80\x7c\x10",
    "\243\007\011\000\x1c\x20\x20\x20\xa8\x20\x20\x42\xbc",
    "\244\007\007\001\x82\x38\x44\x44\x44\x38\x82",
    "\245\007\011\000\x82\x82\x82\x7c\x00\x54\x10\x54\x10",
    "\246\001\011\000\x80\x80\x80\x00\x00\x00\x80\x80\x80",
    "\247\005\001\011\xd8",
    "\251\007\011\000\x7c\x82\x9a\xa2\xa2\xa2\x9a\x82\x7c",
    "\252\005\007\003\x70\x08\x68\x88\x70\x00\xf8",
    "\253\005\005\002\x48\x90\x00\x90\x48",
    "\254\007\004\001\xfc\x02\x02\x02",
    "\255\005\001\004\xf8",
    "\256\007\011\000\x7c\x82\x92\xaa\xb2\xaa\xaa\x82\x7c",
    "\257\005\001\011\xf8",
    "\260\005\005\005\x70\x88\x88\x88\x70",
    "\261\007\007\002\x10\x10\xd6\x10\x10\x00\xfe",
    "\262\004\005\005\xe0\x10\x60\x80\xf0",
    "\263\004\005\005\xe0\x10\xe0\x10\xe0",
    "\264\003\003\007\x60\x80\x80",
    "\265\001\001\003\x80",
    "\270\002\005\005\x40\xc0\x40\x40\x40",
    "\272\005\006\004\x70\x88\x88\x70\x00\xf8",
    "\273\005\005\002\x90\x48\x00\x48\x90",
    "\274\007\011\000\x08\x00\x08\x08\x70\x80\x80\x80\x7e",
    "\300\007\012\000\x20\x18\x00\x7c\x82\x82\x82\xba\x82\x82",
    "\301\007\012\000\x08\x30\x00\x7c\x82\x82\x82\xba\x82\x82",
    "\302\007\012\000\x38\x44\x00\x7c\x82\x82\x82\xba\x82\x82",
    "\303\007\012\000\x32\x4c\x00\x7c\x82\x82\x82\xba\x82\x82",
    "\304\007\012\000\x6c\x00\x00\x7c\x82\x82\x82\xba\x82\x82",
    "\305\007\012\000\x38\x44\x38\x7c\x82\x82\x82\xba\x82\x82",
    "\306\010\011\000\x77\x88\x88\x88\x8b\xa8\x88\x88\x8b",
    "\307\006\012\000\x20\x18\x00\x7c\x80\x80\xb8\x80\x80\x7c",
    "\311\006\012\000\x08\x30\x00\x7c\x80\x80\xb8\x80\x80\x7c",
    "\312\006\012\000\x38\x44\x00\x7c\x80\x80\xb8\x80\x80\x7c",
    "\313\006\012\000\x6c\x00\x00\x7c\x80\x80\xb8\x80\x80\x7c",
    "\314\003\012\000\x80\x60\x00\x40\x40\x40\x40\x40\x40\x40",
    "\315\003\012\000\x20\xc0\x00\x40\x40\x40\x40\x40\x40\x40",
    "\316\005\012\000\x70\x88\x00\x20\x20\x20\x20\x20\x20\x20",
    "\317\005\012\000\xd8\x00\x00\x20\x20\x20\x20\x20\x20\x20",
    "\320\007\011\000\xbc\x82\x82\x82\xb2\x82\x82\x82\xbc",
    "\321\007\012\000\x32\x4c\x00\x7c\x82\x82\x82\x82\x82\x82",
    "\322\007\012\000\x20\x18\x00\x7c\x82\x82\x82\x82\x82\x7c",
    "\323\007\012\000\x08\x30\x00\x7c\x82\x82\x82\x82\x82\x7c",
    "\324\007\012\000\x38\x44\x00\x7c\x82\x82\x82\x82\x82\x7c",
    "\325\007\012\000\x32\x4c\x00\x7c\x82\x82\x82\x82\x82\x7c",
    "\326\007\012\000\x6c\x00\x00\x7c\x82\x82\x82\x82\x82\x7c",
    "\327\005\005\001\x88\x50\x00\x50\x88",
    "\330\007\011\000\x7a\x84\x82\x8a\x92\xa2\x82\x42\xbc",
    "\331\007\012\000\x20\x18\x00\x82\x82\x82\x82\x82\x82\x7c",
    "\332\007\012\000\x08\x30\x00\x82\x82\x82\x82\x82\x82\x7c",
    "\333\007\012\000\x38\x44\x00\x82\x82\x82\x82\x82\x82\x7c",
    "\334\007\012\000\x6c\x00\x00\x82\x82\x82\x82\x82\x82\x7c",
    "\335\007\012\000\x08\xb2\x82\x82\x82\x7c\x00\x10\x10\x10",
    "\336\007\011\000\x80\x80\xbc\x82\x82\x82\xbc\x80\x80",
    "\337\007\011\000\x3c\x42\x42\x42\x5c\x42\x42\x42\x9c",
    "\340\006\012\000\x40\x30\x00\x00\x78\x04\x74\x84\x84\x78",
    "\341\006\012\000\x10\x60\x00\x00\x78\x04\x74\x84\x84\x78",
    "\342\006\012\000\x70\x88\x00\x00\x78\x04\x74\x84\x84\x78",
    "\343\006\012\000\x64\x98\x00\x00\x78\x04\x74\x84\x84\x78",
    "\344\006\012\000\xd8\x00\x00\x00\x78\x04\x74\x84\x84\x78",
    "\345\006\012\000\x30\x48\x30\x00\x78\x04\x74\x84\x84\x78",
    "\346\007\006\000\x6c\x12\x52\x94\x90\x6e",
    "\347\006\012\000\x40\x30\x00\x00\x78\x84\x84\xb8\x80\x78",
    "\351\006\012\000\x10\x60\x00\x00\x78\x84\x84\xb8\x80\x78",
    "\352\006\012\000\x70\x88\x00\x00\x78\x84\x84\xb8\x80\x78",
    "\353\006\012\000\xd8\x00\x00\x00\x78\x84\x84\xb8\x80\x78",
    "\354\003\012\000\x80\x60\x00\x40\x00\x40\x40\x40\x40\x40",
    "\355\003\012\000\x20\xc0\x00\x40\x00\x40\x40\x40\x40\x40",
    "\356\005\012\000\x70\x88\x00\x20\x00\x20\x20\x20\x20\x20",
    "\357\005\012\000\xd8\x00\x00\x20\x00\x20\x20\x20\x20\x20",
    "\360\006\011\000\x28\x10\x28\x04\x74\x84\x84\x84\x78",
    "\361\006\011\000\x64\x98\x00\x78\x84\x84\x84\x84\x84",
    "\362\006\012\000\x40\x30\x00\x00\x78\x84\x84\x84\x84\x78",
    "\363\006\012\000\x10\x60\x00\x00\x78\x84\x84\x84\x84\x78",
    "\364\006\012\000\x70\x88\x00\x00\x78\x84\x84\x84\x84\x78",
    "\365\006\012\000\x64\x98\x00\x00\x78\x84\x84\x84\x84\x78",
    "\366\006\012\000\xd8\x00\x00\x00\x78\x84\x84\x84\x84\x78",
    "\367\007\005\001\x38\x00\xfe\x00\x38",
    "\370\006\006\000\x74\x88\x94\xa4\x44\xb8",
    "\371\006\012\000\x40\x30\x00\x00\x84\x84\x84\x84\x84\x78",
    "\372\006\012\000\x10\x60\x00\x00\x84\x84\x84\x84\x84\x78",
    "\373\006\012\000\x70\x88\x00\x00\x84\x84\x84\x84\x84\x78",
    "\374\006\012\000\xd8\x00\x00\x00\x84\x84\x84\x84\x84\x78",
    "\375\007\011\000\x80\x80\x9c\xa2\x82\xa2\x9c\x80\x80",
    ""
  };

element FString {
  String mfoo[2];
  Bool b1;
  Int test() {
    System s;
    mfoo[0] = "";
    mfoo[1] = "";
    String gstr = init(glyphsRadonX[mfoo.lengthof + 1], 0); //item 2 + 1
    Int slen = gstr.lengthof; // =13
    s.print(slen);
    b1 = (slen == 13);
    s.assert(b1);
    s.assert(gstr[0] == '#');

    s.print(glyphsRadonX[3].lengthof); //constant item, but regnum is runtime?
    s.assert(glyphsRadonX[3].lengthof == 13);
    s.print(glyphsRadonX[3].lengthof + 1); //constant item, folded
    s.assert(glyphsRadonX[3].lengthof + 1 == 14);
    return 0;
 }

  String init(String sarg, Int(3) val)
  {
    return sarg;
  }
}

#:System.ulam
  ulam 1;
quark System {
  Void print(Unsigned arg) native;
  Void print(Int arg) native;
  Void print(Int(4) arg) native;
  Void print(Int(3) arg) native;
  Void print(Unary(3) arg) native;
  Void print(Bool(3) arg) native;
  Void assert(Bool b) native;
}
#.
